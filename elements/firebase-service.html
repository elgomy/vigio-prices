<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
    
<dom-module id="firebase-service">
  <!-- Optional shadow DOM template -->
  <template>
    <style>
      /* CSS rules for your element */
    </style>

    <!-- shadow DOM for your element -->

      <firebase-app
        auth-domain="vigio-prices.firebaseapp.com"
        database-url="https://vigio-prices.firebaseio.com"
        api-key="AIzaSyD6iGMqgnr0O6s7JtBBjRBfuAF6ynfbWIU"
        storage-bucket="vigio-prices.appspot.com"
        project-id="vigio-prices"
        messaging-sender-id="397613272675"
        name="prices-app"
        app="{{fbapp}}">
    </firebase-app>


  </template>

  <script>

    (function(){

    	let firebaseInstance = null;

	    class FirebaseService extends Polymer.Element {

	      static get is() { return 'firebase-service'; }

	      constructor(){
	      	super();
	      	if (!firebaseInstance) firebaseInstance = this;
	      }
	           
	      static get properties() {
	        return {
	          firebaseApp:  Object, 
	          test:{
	          	type:String,
	          	value:'test'
	          }, 
	          subscribers:{
	          	type:Array,
	          	value:()=>[]
	          }          
	        }
	      }

	      static get observers(){
	      	return['fbappChanged(firebaseApp.*)']
	      }

	      fbappChanged(change){
	      	for(var i = 0; i < this.subscribers.length; i++){
	      		this.subscribers[i].notifyPath(change.path)
	      	}
	      }

	      register(subscriberElement){
	      	this.push('subscribers', subscriberElement);
	      	subscriberElement.firebaseApp = this.firebaseApp;
	      	subscriberElement.notifyPath('firebaseApp');
	      	console.log(this.subscribers)
	      }

	      unregister(subscriberElement){
	      	var i = this.subscribers.indexOf(subscriberElement);
	      	if (i > -1) this.subscribers.splice(i,1)
	      }

	    }

	  FirebaseMixin = (superClass) =>{
	    	return class extends superClass{
	    		static get properties(){
	    			return{
	    				firebaseApp:Object
	    			}
	    		}    	

		    	connectedCallback(){
		    		super.connectedCallback();
		    		firebaseInstance.register(this)
		    	}

		    	disconnectedCallback(){
		    		super.disconnectedCallback();
		    		firebaseInstance.unregister(this)
		    	}

	    	}
	  }

	  window.customElements.define(FirebaseService.is, FirebaseService);
	    
	    
	})()

  </script>

</dom-module>